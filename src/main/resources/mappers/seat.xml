<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.Gosk.GoskProject20221221.repository.SeatRepository">

    <resultMap id="seat" type="com.Gosk.GoskProject20221221.domain.seat.Seat">
        <result property="seat_id" column="seat_id"></result>
        <result property="user_id" column="user_id"></result>
        <result property="seat_start_time" column="seat_start_time"></result>
        <result property="seat_total_time" column="seat_total_time"></result>
    </resultMap>

    <resultMap id="reservedSeat" type="com.Gosk.GoskProject20221221.domain.seat.ReservedSeat">
        <result property="reserved_seat_id" column="reserved_seat_id"></result>
        <result property="user_id" column="user_id"></result>
        <result property="reserved_start_time" column="reserved_start_time"></result>
        <result property="reserved_total_time" column="reserved_total_time"></result>
    </resultMap>



    <insert id="paySeat" parameterType="com.Gosk.GoskProject20221221.domain.seat.Seat">
        INSERT INTO
            seat_mst(
                seat_id,
                user_id,
                seat_start_time,
                seat_total_time
        )

        VALUES (
            #{seat_id},
            #{user_id},
            NOW(),
            DATE_ADD(NOW(), INTERVAL #{seat_total_time} HOUR)
        )
    </insert>

    <insert id="payReserved" parameterType="com.Gosk.GoskProject20221221.domain.seat.ReservedSeat">
        INSERT INTO
            reserved_seat_mst(
                reserved_seat_id,
                user_id,
                reserved_start_time,
                reserved_total_time
        )

        VALUES(
            #{reserved_seat_id},
            #{user_id},
            NOW(),
            DATE_ADD(NOW(), INTERVAL #{reserved_total_time} DAY)
        )
    </insert>

    <select id="seatSelect" resultType="com.Gosk.GoskProject20221221.domain.seat.Seat">
        SELECT
            sm.seat_id,
            sm.user_id,
            sm.seat_start_time,
            sm.seat_total_time,

            um.user_id,
            um.user_phone,
            um.user_time

        FROM
            seat_mst sm LEFT OUTER JOIN user_mst um ON (sm.seat_id = um.user_id)

        WHERE
            seat_id = #{seat_id}

    </select>

    <select id="reservedSelect" resultType="com.Gosk.GoskProject20221221.domain.seat.ReservedSeat">
        SELECT
            rm.reserved_seat_id,
            rm.user_id,
            rm.reserved_start_time,
            rm.reserved_total_time,

            um.user_id,
            um.user_phone,
            um.user_time

        FROM
            reserved_seat_mst rm LEFT OUTER JOIN user_mst um ON (rm.reserved_seat_id = um.user_id)

        WHERE
            reserved_seat_id = #{reserved_seat_id}
    </select>

    <insert id="payLocker">
        insert into
            locker_mst
        values
        (
            #{locker_id},
            #{user_id},
            DATE_ADD(NOW(), interval 9 HOUR),
            DATE_ADD((DATE_ADD(NOW(), interval 9 HOUR)), INTERVAL #{locker_end_time} DAY)
        )
    </insert>

    <select id="getLocker" resultType="java.lang.String">
        select
            locker_id
        from
            locker_mst

    </select>

</mapper>
